% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% PROBLEM SET LATEX TEMPLATE FILE
% DEFINE DOCUMENT STYLE, LOAD PACKAGES
\documentclass[11pt,notitlepage]{article}    % ADD COMMENTS USING A PERCENT SIGN
\usepackage{amsfonts}
\usepackage{amsthm}
\usepackage{amsmath, booktabs}
\usepackage{mathtools}
\usepackage{amssymb}
\usepackage{subfig}
\usepackage{setspace}
\usepackage{fullpage}
\usepackage{verbatim}
\usepackage{graphicx}
\usepackage{tabularx}
\usepackage{longtable}
\usepackage{multicol}
\usepackage{multirow}
\setlength{\parindent}{0in}  	% uncomment to remove indent at start of paragraphs
\usepackage{pdflscape}
\usepackage[english]{babel}
\usepackage[pdftex]{hyperref}
\usepackage{natbib}
\usepackage{caption}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{graphics}
\usepackage{multirow}
\usepackage{graphics}
\usepackage{hyperref}
\usepackage{longtable}
\usepackage{latexsym}
\usepackage{rotating}
\usepackage{setspace}
\usepackage{layouts} 
\usepackage[titletoc]{appendix}
\DeclareGraphicsExtensions{.pdf,.jpg,.png}
\usepackage[margin=1in]{geometry}
\usepackage{enumerate}
\usepackage{float}

\newcolumntype{L}[1]{>{\raggedright\let\newline\\\arraybackslash\hspace{0pt}}p{#1}}
\newcolumntype{C}[1]{>{\centering\let\newline\\\arraybackslash\hspace{0pt}}p{#1}}
\newcolumntype{R}[1]{>{\raggedleft\let\newline\\\arraybackslash\hspace{0pt}}p{#1}}

\usepackage[T1]{fontenc}				

\usepackage{xcolor}
\usepackage[printwatermark]{xwatermark}
\newwatermark[allpages,color=black!50,angle=45,scale=1,xpos=0,ypos=0]{DO NOT DISTRIBUTE}

<<setup, include=FALSE, cache=FALSE>>=
rm(list=ls())
library(knitr)
library(ri)
library(foreign)
library(arm)
library(xtable)
library(stargazer)

# set global chunk options
opts_chunk$set(fig.path='figure/PS9-', fig.align='center', fig.show='hold', out.width = '4in', out.height='4in', tidy=FALSE)
options(replace.assign=TRUE,width=90)
@


\title{Field Experiments: Design, Analysis and Interpretation \\
Solutions for Chapter 9 Exercises}
\author{Alan S. Gerber and Donald P. Green\footnote{Solutions prepared by Peter M. Aronow and revised by Alexander Coppock}}
\date{\today}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}

\maketitle


\section*{Question 1}
Important concepts:

\begin{enumerate}[a)]
\item Define CATE. Is a Complier average causal effect (CACE) an example of a CATE?\\
Answer:\\
CATE stands for conditional average treatment effect, or the ATE among a subgroup. Typically, the subgroup in question is defined by some observable covariate(s), such as the CATE for women over 40 years of age. One could, however, define a CATE for a latent group such as Compliers (those who take the treatment if and only if assigned to the treatment group). Therefore, a CACE is a CATE.

\item What is an interaction effect?\\
Answer:\\
An interaction refers to systematic variation in treatment effects. A treatment-by-covariate interaction refers to variation in ATEs that is a function of covariates. A treatment-by-treatment interaction refers to variation in the average effect of one randomized intervention that occurs as a function of other assigned treatments.

\item Describe the multiple comparisons problem and the Bonferroni correction.\\
Answer:\\
The multiple comparisons problem refers to the disortion in $p$-values that occurs when researchers conduct a series of hypothesis tests. When several hypothesis tests are conducted, the chances that at least one of them appears significant may be substantially greater than 0.05, the nominal size of each test. The Bonferroni correction reestablishes the proper size of each test when several hypothesis tests are conducted.   If $k$ tests are conducted at the 0.05 level, the Bonferroni-corrected target significance level is $0.05/k$.
\end{enumerate}

\section*{Question 2}
The standard error formula given in equation (3.4) suggests that, all else being equal, reducing variance in $Y_i(0)$ helps reduce sampling uncertainty. Referring to the procedure outlined in section 9.2, explain why the same principle applies to estimating bounds on treatment effect heterogeneity.\\
Answer:\\
Nonparametric tests of heterogeneity put an estimated lower bound on the variance of the subject-level treatment effect by sorting the observed $Y_i(0)$ and $Y_i(1)$ in ascending order and calculating the difference between them. The variance of this difference is the estimated lower bound.  When the variance of $Y_i(0)$ is small, the variance of the differences between $Y_i(0)$ and $Y_i(1)$ is scarcely affected by whether $Y_i(0)$ is sorted in ascending or descending order. In the limiting case where the variance of $Y_i(0)$ is zero, sorting makes no difference at all; if one were sure that $Y_i(0)$ were constant, one could estimate unit-level treatment effects by subtracting the mean of $Y_i(0)$ from $Y_i(1)$.

\section*{Question 3}
One way to reduce variance in $Y_i(0)$ is to block on a prognostic covariate. When blocking is used, the joint distribution of $Y_i(0)$ and $Y_i(1)$ is simulated within blocks using the bounding procedure described in section 9.2. Using the schedule of potential outcomes below, show how the maximum and minimum values of the covariance of $Y_i(0)$ and $Y_i(1)$ compare to the maximum and minimum values of the covariance of $Y_i(0)$ and $Y_i(1)$ for the dataset as a whole (i.e., had blocking not been used).

% Table generated by Excel2LaTeX from sheet 'Sheet1'
\begin{table}[H]
  \centering
  \caption{Question 3 Table}
    \begin{tabular}{rrrr}
    \toprule
    Block  & Subject  & Yi(0)  & Yi(1)  \\
    \midrule
    A     & A-1   & 0     & 2 \\
    A     & A-2   & 1     & 5 \\
    A     & A-3   & 1     & 3 \\
    A     & A-4   & 2     & 1 \\
    B     & B-1   & 2     & 3 \\
    B     & B-2   & 3     & 3 \\
    B     & B-3   & 4     & 9 \\
    B     & B-4   & 4     & 7 \\
    \bottomrule
    \end{tabular}%
  \label{tab:addlabel}%
\end{table}%


<<Q3,cache=TRUE>>=
block <- c(rep("A", 4), rep("B", 4))
Y0 <- c(0,1,1,2,2,3,4,4)
Y1 <- c(2,5,3,1,3,3,9,7)

# function for calculating population covariances
cov.pop <- function(x,y){sum((x-mean(x))*(y-mean(y)))/(length(x))}

# Ignoring blocks
Y1.lowtohigh <- sort(Y1)
Y1.hightolow <- sort(Y1, decreasing=TRUE)

cov.min <- cov.pop(Y0, Y1.hightolow)
cov.max <- cov.pop(Y0, Y1.lowtohigh)
cov.min
cov.max

# Including blocks
Y1.lowtohigh.block <- c(sort(Y1[block=="A"]), sort(Y1[block=="B"]))
Y1.hightolow.block <- c(sort(Y1[block=="A"],decreasing=TRUE), 
                        sort(Y1[block=="B"],decreasing=TRUE))
cov.min.block <- cov.pop(Y0, Y1.hightolow.block)
cov.max.block <- cov.pop(Y0, Y1.lowtohigh.block)
cov.min.block
cov.max.block
@

The lowest and highest covariances under simple random assignment are -3.14 and 3.23.  In order to find the lowest and highest covariances under blocked assignment, sort the potential outcomes within blocks before calculating the covariances for all observations.  Under blocked random assignment, the lowest covariance is -0.02, and the highest covariance is 2.98. Taking advantange of the blocks reduces the range of possible covariances.


\section*{Question 4}
Suppose that a researcher compares the CATE among two subgroups, men and women. Among men (N = 100), the ATE is estimated to be 8.0 with a standard error of 3.0, which is significant at $p<0.05$. Among women (N = 25), the CATE is estimated to be 7.0 with an estimated standard error of 6.0, which is not significant, even at the 10\% significance level. Critically evaluate the researcher's claim that ``the treatment only works for men; for women, the effect is statistically indistinguishable from zero.'' In formulating your answer, address the distinction between testing whether a single CATE is different from zero and testing whether two CATEs are different from each other. \\
Answer:\\
The researcher's interpretation of the results ignores the fact that the estimated CATE for women is almost as large (7 versus 8) as the estimated CATE among men. The difference between the estimated CATEs (8-7=1) is much smaller than the apparent standard error of the difference (which is the square root of the sum of the estimated standard errors, or 6.7). An alternative interpretation is that both of the CATEs are the same, but the CATE among men is estimated with greater precision because the male sample is much larger than the female sample.

\section*{Question 5}
The table below shows hypothetical potential outcomes for an experiment in which low-income subjects in a developing country are randomly assigned to receive (i) loans to aid their small businesses; (ii) business training to improve their accounting, hiring, and inventory-management skills; (iii) both; or (iv) neither. The outcome measure in business income during the subsequent year. The table also includes a pre-treatment covariate, an indicator scored 1 if the subject was judged to be proficient in these basic business skills.

% Table generated by Excel2LaTeX from sheet 'Sheet1'
\begin{table}[H]
  \centering
  \caption{Question 5 Table}
    \begin{tabular}{rrrrrr}
    \toprule
    Subject & $Y_i(loan)$ & $Y_i(training)$ & $Y_i(both)$ & $Y_i(Neither)$ & Prior business skills \\
    \midrule
    1     & 2     & 2     & 3     & 2     & 0 \\
    2     & 2     & 3     & 2     & 1     & 0 \\
    3     & 5     & 6     & 6     & 4     & 1 \\
    4     & 3     & 1     & 5     & 1     & 1 \\
    5     & 4     & 4     & 5     & 0     & 0 \\
    6     & 10    & 8     & 11    & 10    & 1 \\
    7     & 1     & 3     & 3     & 1     & 0 \\
    8     & 5     & 5     & 5     & 5     & 1 \\ \midrule
    Average & 4     & 4     & 5     & 3     & 0.5 \\
    \bottomrule
    \end{tabular}%
  \label{tab:addlabel}%
\end{table}%

\begin{enumerate}[a)]
\item What is the ATE of the loan if all subjects were also to receive training?\\
Answer:\\
The relevant comparison is the average potential outcomes under ``both'' to the average potential outcome under only ``training.''  The ATE is 5-4=1.

\item What is the ATE of the loan if no subjects receive training?\\
Answer:\\
The relevant comparison is the average potential outcomes under ``loan'' to the average potential outcome under only ``neither.''  The ATE is 4-3=1.

\item What is the ATE of the training if all subjects also receive a loan?\\
Answer:\\
The relevant comparison is the average potential outcomes under ``both'' to the average potential outcome under only ``loan.''  The ATE is 5-4=1.

\item What is the ATE of the training if no subjects receive a loan?\\
Answer:\\
The relevant comparison is the average potential outcomes under ``training'' to the average potential outcome under only ``neither.''  The ATE is 4-3=1.

\item Suppose subjects were randomly assigned to one of the four experimental treatments in equal proportions. Use the table above to fill in the expected values of the four regression coefficients for the model and interpret the results:

\begin{equation}
Y_i = \alpha_0 + \alpha_1 Loan_i + \alpha_2 Training_i + \alpha_3 (Loan_i * Training_i) + e_i
\end{equation}

The four coefficients are $\alpha_0=3$, the average outcome under ``neither''; $\alpha_1=1$, the ATE of loan when there is no training; $\alpha_2=1$, the ATE of training when there is no loan; and $\alpha_3=0$ the change in the effect of training that occurs when our focus switches from those who receive no loan to those who receive a loan.  Note that this interaction term can also be interpreted as the change in the ATE of loans that we observe when we move from the untrained subgroup to the trained subgroup. 

\begin{equation}
Y_i = 3 + 1*Loan_i + 1*Training_i + 0*(Loan_i * Training_i) + e_i
\end{equation}


\item Suppose a researcher were to implement a block randomized experiment, such that two subjects with business skills are assigned to receive loans, and two subjects without business skills are assigned to receive loans, and the rest are assigned to control. No subjects are assigned to receive training. The researcher estimates the model

\begin{equation}
Y_i = \gamma_0 + \gamma_1 Loan_i + \gamma_2 Skills_i + \gamma_3 (Loan_i * Skills_i) + e_i
\end{equation}

Over all 36 possible random assignments, the average estimated regression is as follows:

\begin{equation}
Y_i = 1.00 + 1.25 Loan_i + 4.00 Skills_i - 0.50 (Loan_i * Skills_i)
\end{equation}

Interpret the results and contrast them with the results from part (e). (Hint: the block randomized design does not affect the interpretation. Focus on the distinction between treatment-by-treatment and treatment-by-covariate interactions.)\\
Answer:\\
The key thing to bear in mind when interpreting these results is that the interaction between loans and skills is a treatment-by-covariate interaction because skills are not randomly assigned. The results seem to suggest that loans are more effective amongst those without skills (CATE = 1.25) than among those with skills (CATE = 1.25 - 0.5 = 0.75). These CATEs may describe the ATEs in these two skill groups, but the change in CATEs does not necessarily imply that a random increase in skill would diminish the effects of loans.  
\end{enumerate}

\section*{Question 6}
Rind and Bordia studied the tipping behavior of lunchtime patrons of an ``upscale Philadelphia restaurant'' who were randomly assigned to four experimental groups.\footnote{Rind and Bordia 1996.} One factor was server sex (male or female), and a second factor was whether the server draws a ``happy face'' on the back of the bill presented to customers.\footnote{The authors took steps to ensure the blindness of the servers to the happy face condition, which was determined only moments before the bill was delivered. The authors also instructed waitstaff to deliver bills and walk away, so that there would be no additional interaction with customers. It is not clear whether the sex of the server was randomly assigned.} Download the data located at http://isps.research.yale.edu/FEDAI.

<<Q6setup, cache=FALSE, include=FALSE>>=
rm(list=ls())
library(foreign)
library(lmtest)
rindb <- read.dta("../Programs and Data/Chapter 9/Problem 9.6 Rind and Bordia.dta")
@


\begin{enumerate}[a)]
\item Suppose you ignored the sex of the server and simply analyzed whether the happy face treatment has heterogeneous effects. Use randomization inference to test whether $Var(\tau_i) = 0$ by testing whether $Var(Y_i(1)) = Var(Y_i(0))$. Construct the full schedule of potential outcomes by assuming that the treatment effect is equal to the observed difference-in-means between $Y_i(1)$ and $Y_i(0)$. Interpret your results.\\

<<Q6a, cache=TRUE>>=
library(ri)
# generate a treatment indicator
Z <- as.integer(rindb$happyface) - 1  
Y <- rindb$tip

probs <- genprobexact(Z)
ate <- estate(Y,Z,prob=probs)

numiter <- 10000
set.seed(343)
perms <- genperms(Z,maxiter=numiter)

# generate a schedule of potential outcomes under the assumption 
# that the treatment effect equals the estimated ATE for all subjects
Ys <- genouts(Y,Z,ate=ate)            

# compare variances in treatment and control groups
testvar <- var(Y[Z==1]) - var(Y[Z==0])   
vardist <- rep(NA,numiter)               

# generate the sampling distribution of the difference in variances
for (i in 1:numiter) vardist[i] <- var(Y[perms[,i]==1]) - var(Y[perms[,i]==0])

# p-value for var(Y1)>Var(Y0)
mean(vardist >= testvar)           
# p-value for var(Y1)<>Var(Y0)
mean(abs(vardist) >= abs(testvar)) 
@

We constructed a simulation of 10,000 random assignments and for each assessed the difference in variances between treatment and control group. The observed difference is \Sexpr{round(testvar,2)}. However, this absolute difference has a p-value of 0.472.  We cannot reject the null hypothesis that the observed difference in variances is the produce of random samping variability. The failure to reject the null is not surprising given the low power of this test, which does not focus on any specific model of heterogeneous treatment effects.


\item Write down a regression model that depicts the effect of the sex of the waitstaff, whether they write a happy face on the bill, and the interaction of these factors.\\
Answer:\\
Using tip percentage as the outcome and a binary variable for sex (female=1) and for the use of a happy face (face=1), a regression model is as follows: 
\begin{equation}
Y_i = \gamma_0 + \gamma_1 Sex_i + \gamma_2 Face_i + \gamma_3 (Sex_i * Face_i) + e_i
\end{equation}

\item Estimate the regression model in (b) and test the interaction between waitstaff sex and the happy face treatment. Is the interaction significant? \\
Answer:\\
<<Q6c, cache=TRUE>>=
# generate indicator of waitstaff sex
female <- as.integer(rindb$female) - 1   

# regression with interaction between happyface and waitstaff sex
lmmodelint <- lm(Y ~ Z + female + Z * female)      
# regression model without interaction
lmmodel <- lm(Y ~ Z + female)    

summary(lmmodelint)

#Confirm p-value with RI

# use estimated coefficients from base model to impute potential outcomes
Y0 <- Y - lmmodel$coefficients["Z"] * Z
Y1 <- Y + lmmodel$coefficients["Z"] * (1 - Z)

f.obs <- waldtest(lmmodelint, lmmodel)$F[2]
f.sims <- rep(NA,numiter)

for (i in 1:numiter) {
  Z.sim <- perms[,i]
  Y.sim <- Y1 * Z.sim + Y0 * (1 - Z.sim)
	
	# regressions based on two nested models: with and without interaction
  lmmodelint.sim <- lm(Y.sim ~ Z.sim + female + female * Z.sim)
  lmmodel.sim <- lm(Y.sim ~ Z.sim + female)
	# calculate the F-statistic by comparing two nested models
  f.sims[i] <- waldtest(lmmodelint.sim, lmmodel.sim)$F[2]	
}

# calculate the p-value by comparing the observed F-statistic 
# to the F-statistic under the null of constant & additive effects
mean(f.sims >= f.obs)   
@
\end{enumerate}

The regression reported above suggests a positive interaction between the happyface treatment and female, implying that female waitstaff receive much more return from happyfaces than male waitstaff. The two-sided p-value from the regression is 0.049, which is similar to the result from randomization inference ($p=0.0483$).  A two-sided test is appropriate here because the direction of the effect was not predicted ex ante.  Thinking back to section (a), the specific interaction posited by this regression sets the stage for a more powerful test of treatment effect heterogeneity.

\section*{Question 7}
In their 2004 study of racial discrimination in employment markets, Bertrand and Mullainathan sent resumes with varying characteristics to firms advertising job openings. Some firms were sent resumes with putative African American names, while other firms received resumes with putatively Caucasian names. The researchers also varied other attributes of the resume, such as whether the resume was judged to be of high or low quality (based on labor market experience, career profile, gaps in employment, and skills listed).\footnote{Bertrand and Mullainathan 2004, p. 994.} The table below shows the rate at which applicants were called back by employers, by the city in which the experiment took place and by the randomly assigned attributes of their applications.

% Table generated by Excel2LaTeX from sheet 'Sheet1'
\begin{table}[H]
  \centering
  \caption{Question 7 Table}
    \begin{tabular}{rrrrrrrrr}
    \toprule
          & \multicolumn{4}{c}{Boston}    & \multicolumn{4}{c}{Chicago} \\
    \midrule
          & \multicolumn{2}{c}{Low-quality resume} & \multicolumn{2}{c}{High-quality resume } & \multicolumn{2}{c}{Low-quality resume} & \multicolumn{2}{c}{High-quality resume } \\
          & Black & White & Black & White & Black & White & Black & White \\
    \% Received Call & 7.01  & 10.15 & 8.5   & 13.12 & 5.52  & 7.16  & 5.28  & 8.94 \\
    (N)   & (542) & (542) & (541) & (541) & (670) & (670) & (682) & (682) \\
    \bottomrule
    \end{tabular}%
  \label{tab:addlabel}%
\end{table}%

\begin{enumerate}[a)]
\item For each city, interpret the apparent treatment effects of race and resume quality on the probability of receiving a follow-up call.\\
Answer:\\
For Boston, the effect of (white) race is 10.15 - 7.01 = 3.14 when resume quality is low and 13.12 - 8.50 = 4.62 when resume quality is high. For Chicago, the effect of (white) race is 7.16 - 5.52 = 1.64 when resume quality is low and 8.94 - 5.28 = 3.66 when resume quality is high. Note that another, equally valid way to interpret the table is to assess the effect of resume quality for each race, but the substantive focus of this study is on race effects.

\item Propose a regression model that assesses the effects of the treatments, interaction between them, and interactions between the treatments and the covariate, city. \\
Answer:\\
This model is similar to the interactive regression specifications described above, but it contains treatment-by-treatment interactions (race x resume) and treatment-by-covariate interactions (race x city, resume x city) and a higher order interaction (race x resume x city) that allows for the possibility that the race x resume interaction differs by city.  Here, City is scored 1 if Chicago.  Race = 1 if white.  Resume =1 if high quality.  Notice that the ``saturated'' regression model contains eight parameters, one for each cell of the table. 

\begin{align*}
Y_i &= \gamma_0 + \gamma_1 Race_i + \gamma_2 Resume_i + \gamma_3 City_i + \\
& \gamma_4 (Race_i * Resume_i) + \gamma_5 (Race_i * City_i) + \gamma_6 (Resume_i * City_i) + \gamma_7 (Race_i * Resume_i * City_i) + e_i
\end{align*}

\item Estimate the parameters in your regression model. Interpret the results (This can be done by hand based on the percentages given in the table.) \\
Answer:\\
Because there as many parameters as experimental groups, the estimated coefficients reproduce the percentages given in the table:

\begin{align*}
Y_i &= 7.01 + 3.14 Race_i + 1.49 Resume_i -1.49 City_i + \\
& 1.48 (Race_i * Resume_i) -1.50  (Race_i * City_i) -1.73  (Resume_i * City_i) + 0.54 (Race_i * Resume_i * City_i) + e_i
\end{align*}


Additional response (Boston = 1; Black = 1; Low quality = 1)
\begin{align*}
Y_i &= 8.94 - 3.66 Race_i - 1.78 Resume_i + 4.18 City_i + \\
& 2.02 (Race_i * Resume_i) - 0.96  (Race_i * City_i) - 1.19  (Resume_i * City_i) -0.54 (Race_i * Resume_i * City_i) + e_i
\end{align*}

Additional response (Boston = 1; Black = 1; High quality = 1)
\begin{align*}
Y_i &= 7.16 - 1.64 Race_i + 1.78 Resume_i + 2.99 City_i - \\
& 2.02 (Race_i * Resume_i) - 1.50  (Race_i * City_i) + 1.19  (Resume_i * City_i) + 0.54 (Race_i * Resume_i * City_i) + e_i
\end{align*}

<<q7, cache=TRUE, results='asis'>>=
Y <- c(rep(1, 38), rep(0, 542-38), rep(1, 55), rep(0, 542-55), 
       rep(1, 46), rep(0, 541-46), rep(1, 71), rep(0, 541-71), 
       rep(1, 37), rep(0, 670-37), rep(1, 48), rep(0, 670-48),
       rep(1, 36), rep(0, 682-36), rep(1, 61), rep(0, 682-61))

boston <- c(rep(1, 542+542+541+541), rep(0, 670+670+682+682))
chicago <- 1-boston
lowquality <- c(rep(1, 542+542), rep(0, 541+541), rep(1, 670+670), rep(0, 682+682))
highquality <- 1-lowquality
black<- c(rep(1, 542), rep(0,542), rep(1, 541), rep(0,541), 
          rep(1, 670), rep(0,670), rep(1, 682), rep(0,682))
white <- 1-black

# All the models are
# Y ~ race + quality + city + race*quality + race*city + quality*city + race*quality*city
# In principle, there are 8 possibilities... here are 4.

fit_1 <- lm(Y ~ white + highquality + chicago + white*highquality + 
              white*chicago + highquality*chicago + white*highquality*chicago)
fit_2 <- lm(Y ~ black + highquality + chicago + black*highquality + 
              black*chicago + highquality*chicago + black*highquality*chicago)
fit_3 <- lm(Y ~ white + highquality + boston + white*highquality + 
              white*boston + highquality*boston + white*highquality*boston)
fit_4 <- lm(Y ~ black + lowquality + chicago + black*lowquality + 
              black*chicago + lowquality*chicago + black*lowquality*chicago)
stargazer(fit_1, fit_2, fit_3, fit_4, style = "apsr", notes = c("Coeffcients depend on student's parameterization", "All four models are equivalent." ), title= "Question 7C Table")
@
\end{enumerate}

\section*{Question 8}
In Chapter 3, we analyzed data from Clingingsmith, Khwaja, and Kremer's study of Pakistani Muslims who participated in a lottery to obtain a visa for the pilgrimage to Mecca.\footnote{Clingingsmith, Khwaja, and Kremer 2009.} By comparing lottery winners to lottery losers, the authors are able to estimate the effects of the pilgrimage on various attitudes, including views about people from other countries. Winners and losers were asked to rate the Saudi, Indonesian, Turkish, African, European, and Chinese people on a five-point scale ranging from very negative ($-2$) to very positive ($+2$). Adding the responses to all six items creates an index ranging from $-12$ to $+12$. The key results are presented in the table below.

% Table generated by Excel2LaTeX from sheet 'Sheet1'
\begin{table}[htbp]
  \centering
  \caption{Question 8 table}
    \begin{tabular}{rrr}
    \toprule
          & Control group  & Treatment group  \\
    \midrule
    N     & 448   & 510 \\
    Mean  & 1.868 & 2.343 \\
    Variance  & 5.793 & 6.902 \\
    Absolute difference in variances  & \multicolumn{2}{c}{1.109} \\
    \bottomrule
    \end{tabular}%
  \label{tab:addlabel}%
\end{table}%

\begin{enumerate}[a)]
\item Explain the meaning of ``absolute difference in variances.'' \\
Answer:\\
The term ``difference in variances'' is the observed difference between the variance of outcomes in the treatment group and the variance of outcomes in the control group. The term ``absolute'' refers to the absolute value of this difference.
\item Describe how one could use randomization inference to test the null hypothesis of constant treatment effects. \\
Answer:\\
One method is to create a full schedule of potential outcomes under the null hypothesis of constant treatment effects.  For example, we could assume that all subjects have a treatment effect equal to the observed ATE. In order to obtain untreated potential outcomes for the treatment group, we subtract off the ATE from the observed treated potential outcomes. In order to obtain the treated potential outcomes for the control group, we add the apparent ATE.  We then simulate a large number of possible random assignments; for each random assignment, we calculate the absolute difference between the variance of the treatment group and the variance of the control group. We obtain $p$-values by determining where the observed absolute difference falls in the sampling distribution under the null hypothesis.

\item Assume that researchers applied the method you proposed in part (b) and simulated 100,000 random assignments, each time calculating the absolute difference in variances; they find that 25,220 of these differences are as large or larger than 1.109, the absolute difference in variances observed in the original sample. Calculate the $p$-value implied by these results. What do you conclude about treatment effect heterogeneity in this example? \\
Answer:\\
The p-value is 25220/100000 = 0.2522.  The difference in observed variances is consistent with (and thus we cannot reject) the null hypothesis of homogeneous effects.

\item Suppose that this experiment were partitioned into subgroups defined according to whether the subjects had travelled abroad in the past. Suppose that the CATE among those who had previously travelled abroad were 0 and that the CATE among those who had not travelled abroad were 1.0. Suppose this difference in CATEs were significant at $p< .05$. Does this result imply that randomly encouraging people to travel abroad eliminates the Hajj's effect?\\
Answer:\\
Not necessarily.  This regression reports a treatment-by-covariate interaction, which describes the CATEs for two subgroups that may or may not have similar potential outcomes.  Randomly encouraging travel is designed to create groups with the same expected potential outcomes; this design tests whether travel causes the effect of the Hajj to change.

\end{enumerate}
\section*{Question 9}
An example of a two-factor design that encounters one-sided noncompliance may be found in Fieldhouse et al.'s study of voter mobilization in the United Kingdom.\footnote{Fieldhouse et al. 2010.} In this study, the first factor is whether each voter was mailed a letter encouraging him or her to vote in the upcoming election. The second factor is whether each voter was called with an encouragement to vote. Noncompliance occurs in the case of phone calls, as some targeted voters cannot be reached when called. The experimental design consists of four groups: a control group, a mail-only group, a phone-only group, and a group targeted for both mail and phone. The following table shows the results by assigned experimental group.
% Table generated by Excel2LaTeX from sheet 'Sheet1'
\begin{table}[htbp]
  \centering
  \caption{Question 9 Table}
    \begin{tabular}{R{5cm}rrrr}
    \toprule
          & Control  & Mail Only  & Phone Only  & Mail and Phone  \\
    \midrule
    N     & 5179  & 4367  & 3466  & 2287 \\
    Number Contacted by Phone  & 0     & 0     & 2003  & 1363 \\
    Among those Assigned to this Experimental Group, Percent who Voted  & 0.397 & 0.403 & 0.397 & 0.418 \\
    Among those Contacted by Phone, Percent who Voted  & NA    & NA    & 0.465 & 0.468 \\
    \bottomrule
    \end{tabular}%
  \label{tab:addlabel}%
\end{table}%


\begin{enumerate}[a)]
\item Show that, under certain assumptions, this experimental design allows one to identify the following parameters: (i) the ATE of mail, (ii) the Complier average causal effect (CACE) of phone calls, (iii) the CATE of mail among those who comply with the phone call treatment, (iv) the CATE of mail among those who do not comply with the phone call treatment, and (v) the CACE of phone calls among those who receive mail. \\
Answer:\\

\begin{enumerate}[(i)]

\item \textbf{ATE of mail.} The ATE of mail is identified using the core assumptions of chapter 2 (random assignment, non-interference, and excludability). Excludability in this holds that the only way that random assignment of mail affects outcomes is through the mail treatment itself. 

\item \textbf{Complier average causal effect (CACE) of phone calls.} In order identify the CACE of phone calls, we must invoke the assumptions of Chapter 5, since this is a case of one-sided non-compliance. Again, the exclusion restriction holds that the only way that the assignment of phone calls affects outcomes is through actual phone contacts. The CACE here is ATE among those who receive phone calls if assigned to the treatment group.

\item \textbf{CATE of mail among those who comply with the phone call treatment.}  The CATE of mail is identified in the same was as an ATE, except that it is restricted to those who actually receive phone calls

\item \textbf{CATE of mail among those who do not comply with the phone call treatment.} Same as above, but among those who are not treated when called.

\item \textbf{CACE of phone calls among those who receive mail.} The CACE of phone calls among those who receive mail is identified among the same group of compliers as the CACE above, since mail is assigned and received randomly (because we assume full compliance with the mail treatment). However, the ATE of the calls among Compliers may differ from the ATE among Compliers who also receive mail, due to a treatment-by-treatment interaction. 

\end{enumerate}

\item Using the identification strategies you laid out in part (a), estimate each of the five parameters using the results in the table.

\begin{enumerate}[(i)]

\item \textbf{ATE of mail.} The estimated ATE of mail is 40.3 - 39.7 = 0.6 percentage points.

\item \textbf{Complier average causal effect (CACE) of phone calls.} The estimated CACE of phone calls is the ITT divided by the share of compliers: (39.7 - 39.7)/ (2003/3466) = 0. 

\item \textbf{CATE of mail among those who comply with the phone call treatment.}  The CATE of mail among those who receive a call is 46.8 - 46.5 = 0.3 percentage points. 

\item \textbf{CATE of mail among those who do not comply with the phone call treatment.}  In order to figure out the CATE of mail among those who did not comply when called, we must first back out the voting rates given the numbers presented above. For example, the overall voting rate in the treatment group of 41.8 is a weighted average of the voting rates among the contacted and uncontacted. Thus, 41.8 = 46.8(1363/2287) + X(923/2287). Solving for X gives 34.4, and repeating the same calculation for the control group gives 30.4. Therefore, the estimated effect of mail for this subgroup is 4.0 percentage points. 

\item \textbf{CACE of phone calls among those who receive mail.} The CACE of phone calls among those who receive mail is the ITT divided by the contact rate: (41.8 - 40.3) / (1363/2287) = 2.5 percentage points

\end{enumerate}


\item In Chapters 5 and 6, we discussed the use of instrumental variables regression to estimate CACEs when experiments involve noncompliance. Here, we can apply instrumental variables regression to a factorial experiment in which one factor encounters noncompliance. With the replication dataset at http://isps.research.yale.edu/FEDAI, use instrumental variables regression to estimate the parameters of the Vote equation in the following three-equation regression model:\\

\begin{align*}
PhoneContact_i &= \alpha_0 + \alpha_1 Mail_i + \alpha_2 PhoneAssign_i + \alpha_3(PhoneAssign_i * Mail_i) + e_i \\
PhoneContact_i * Mail_i &= \gamma_0 + \gamma_1 Mail_i + \gamma_2 PhoneAssign_i + \gamma_3(PhoneAssign_i *
Mail_i) + \epsilon_i \\
Vote_i &= \beta_0 + \beta_1 Mail_i + \beta_2 PhoneContact_i + \beta_3(PhoneContact_i * Mail_i) + u_i
\end{align*}

Interpret the regression estimates in light of the five parameters you estimated in part (b). Which causal parameters does instrumental variables regression estimate or fail to estimate?
<<Q9setup, cache=FALSE, include=FALSE>>=
fieldhouse <- read.dta("../Programs and Data/Chapter 9/Problem 9.9 Fieldhouse.dta")
library(AER)
@

<<Q9, cache=TRUE>>=
fieldhouse <- within(fieldhouse,{
  mail <- m
  phone <- p
  phone_contact <- c
  vote <- y
})

fit.iv <- ivreg(vote ~ mail + phone_contact + phone_contact * mail
                | mail + phone + mail * phone,
                data = fieldhouse)
summary(fit.iv)
@

The intercept is the voting rate in the control group. The coefficient for ``phone contact'' is the estimated CACE for phones when no mail is assigned.  The effect for ``mail'' is the ATE for mail when no phone calls are assigned. The coefficient for ``mail:phone contact'' is the extent to which the apparent CACE of phone calls increases when we move from the no-mail to the mail group. These estimates reproduce the estimates generated by hand above. Notice that IV regression does not report the effect of mail for non-compliers.
\end{enumerate}


\end{document}

