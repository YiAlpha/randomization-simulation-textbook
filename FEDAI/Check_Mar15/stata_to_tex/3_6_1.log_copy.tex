. 
. // download data from: http://hdl.handle.net/10079/6hdr852
. // copy and paste the url to your web browser
. 
. 
. import delim "Clingingsmith_et_al_QJE_2009dta.csv",clear
(8 vars, 958 obs)

. set seed 1234567

. 
. rename success D

. rename views Y

. 
. 
. //findit tsrtest
. //package name:  st0158.pkg install
. 
. cap program drop ate

. program define ate, rclass
  1.         args Y D
  2.     sum `Y' if `D'==1, meanonly
  3.     local Y_treat=r(mean)
  4.     sum `Y' if `D'==0, meanonly
  5.     local Y_con=r(mean)
  6.     return scalar ate_avg = `Y_treat'-`Y_con'
  7. end

. 
. // ssc install tsrtest
. tsrtest D r(ate_avg) using 3_6_resam.dta, overwrite: ate Y D
Two-sample randomization test for theta=r(ate_avg) of ate Y D by D

Combinations:   8.4503047638e+285 = (958 choose 448)
Assuming null=0
Observed theta: .4748

Minimum time needed for exact test (h:m:s):  2.6e+278:00:00
Reverting to Monte Carlo simulation.
Mode: simulation (10000 repetitions)

progress: |........................................|

 p=0.00190 [one-tailed test of Ho:  theta(D==0)<=theta(D==1)]
 p=0.99830 [one-tailed test of Ho:  theta(D==0)>=theta(D==1)]
 p=0.00360 [two-tailed test of Ho:  theta(D==0)==theta(D==1)]

Saving log file to 3_6_resam.dta...done.

.   
. 
. preserve 

. use "3_6_resam.dta", clear

. global ate = theta[1]

. di $ate
.4748337

. drop if _n==1
(1 observation deleted)

. count if theta >= $ate
  19

. scalar p_onesided = r(N)/_N

. count if abs(theta) >= $ate
  36

. scalar p_twosided = r(N)/_N

. di "p.value.onesided = "p_onesided
p.value.onesided = .0019

. di "p.value.twosided = "p_twosided 
p.value.twosided = .0036

. restore

. 
. 
