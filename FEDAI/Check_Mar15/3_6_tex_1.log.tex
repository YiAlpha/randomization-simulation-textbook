. import delim "Clingingsmith_et_al_QJE_2009dta.csv",clear
(8 vars, 958 obs)
{\smallskip}
. set seed 1234567
{\smallskip}
. 
. rename success D
{\smallskip}
. rename views Y
{\smallskip}
. 
. 
. //findit tsrtest
. //package name:  st0158.pkg install
. 
. cap program drop ate
{\smallskip}
. program define ate, rclass
  1.         args Y D
  2.     sum `Y' if `D'==1, meanonly
  3.     local Y_treat=r(mean)
  4.     sum `Y' if `D'==0, meanonly
  5.     local Y_con=r(mean)
  6.     return scalar ate_avg = `Y_treat'-`Y_con'
  7. end
{\smallskip}
. 
. // ssc install tsrtest
. tsrtest D r(ate_avg) using 3_6_resam.dta, overwrite: ate Y D
Two-sample randomization test for theta=r(ate_avg) of ate Y D by D
{\smallskip}
Combinations:   8.4503047638e+285 = (958 choose 448)
Assuming null=0
Observed theta: .4748
{\smallskip}
Minimum time needed for exact test (h:m:s):  7.9e+278:00:00
Reverting to Monte Carlo simulation.
Mode: simulation (10000 repetitions)
{\smallskip}
progress: |........................................|
{\smallskip}
 p=0.00190 [one-tailed test of Ho:  theta(D==0)<=theta(D==1)]
 p=0.99830 [one-tailed test of Ho:  theta(D==0)>=theta(D==1)]
 p=0.00360 [two-tailed test of Ho:  theta(D==0)==theta(D==1)]
{\smallskip}
Saving log file to 3_6_resam.dta...done.
{\smallskip}
.   
. 
. preserve 
{\smallskip}
. use "3_6_resam.dta", clear
{\smallskip}
. global ate = theta[1]
{\smallskip}
. di $ate
.4748337
{\smallskip}
. drop if _n==1
(1 observation deleted)
{\smallskip}
. count if theta >= $ate
  19
{\smallskip}
. scalar p_onesided = r(N)/_N
{\smallskip}
. count if abs(theta) >= $ate
  36
{\smallskip}
. scalar p_twosided = r(N)/_N
{\smallskip}
. di "p.value.onesided = "p_onesided
p.value.onesided = .0019
{\smallskip}
. di "p.value.twosided = "p_twosided 
p.value.twosided = .0036
{\smallskip}
. restore
{\smallskip}
. 
