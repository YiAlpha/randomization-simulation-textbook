#
bols <- (solve(t(xint) %*% xint)) %*% (t(xint) %*% y)#
bols#
out <- optim(bols,llprobit,x=x,y=y,method="BFGS",hessian = T)#
out#
stderrs <- as.matrix(sqrt(diag(solve(out$hessian))))#
#
print(cbind(out$par,stderrs),digits=3)
rm(list = ls())#
library(MASS)#
library(foreign)#
data <- read.dta("/Users/alissastollwerk/Documents/Columbia/Fall 2010/POLS W4291 - LDV Stats/greene_labor.dta")
llprobit <- function(b,x,y) {#
#
y <- as.matrix(y)#
x1 <- as.matrix(x)#
xint <- cbind(1,x)#
xb <- xint %*% b #
#
return(-sum (y * (log(pnorm(xb))) + (1-y) * log(1-pnorm(xb)))) #
}#
#
x <-  cbind(data[,2],data[,9],data[,5],data[,3],data[,10])#
xint <-cbind(1,x)#
y <- data[,1]#
#
bols <- (solve(t(xint) %*% xint)) %*% (t(xint) %*% y)#
bols#
out <- optim(bols,llprobit,x=x,y=y,method="BFGS",hessian = T)#
out#
stderrs <- as.matrix(sqrt(diag(solve(out$hessian))))#
#
print(cbind(out$par,stderrs),digits=3)
rm(list = ls())#
library(MASS)#
library(foreign)#
data <- read.dta("/Users/alissastollwerk/Documents/Columbia/Fall 2010/POLS W4291 - LDV Stats/greene_labor.dta")
llprobit <- function(b,x,y) {#
#
y <- as.matrix(y)#
x <- as.matrix(x)#
xint <- cbind(1,x)#
xb <- xint %*% b #
#
return(-sum (y * (log(pnorm(xb))) + (1-y) * log(1-pnorm(xb)))) #
}#
#
x <-  cbind(data[,2],data[,9],data[,5],data[,3],data[,10])#
xint <-cbind(1,x)#
y <- data[,1]#
#
bols <- (solve(t(xint) %*% xint)) %*% (t(xint) %*% y)#
bols#
out <- optim(bols,llprobit,x=x,y=y,method="BFGS",hessian = T)#
out#
stderrs <- as.matrix(sqrt(diag(solve(out$hessian))))#
#
print(cbind(out$par,stderrs),digits=3)
rm(list = ls())#
library(MASS)#
library(foreign)#
data <- read.dta("/Users/alissastollwerk/Documents/Columbia/Fall 2010/POLS W4291 - LDV Stats/greene_labor.dta")
llprobit <- function(b,x,y) {#
#
y <- as.matrix(y)#
x <- as.matrix(x)#
xint <- cbind(1,x)#
xb <- xint %*% b #
#
return(-sum (y * (log(pnorm(xb))) + (1-y) * log(1-pnorm(xb)))) #
}#
#
x <-  cbind(data[,2],data[,9],data[,5],data[,3],data[,10])#
xint <-cbind(1,x)#
y <- data[,1]#
#
#
bols <- (solve(t(xint) %*% xint)) %*% (t(xint) %*% y)#
bols#
out <- optim(bols,llprobit,x=x,y=y,method="BFGS",hessian = T)#
out#
stderrs <- as.matrix(sqrt(diag(solve(out$hessian))))#
#
print(cbind(out$par,stderrs),digits=3)
rm(list = ls())#
library(MASS)#
library(foreign)#
data <- read.dta("/Users/alissastollwerk/Documents/Columbia/Fall 2010/POLS W4291 - LDV Stats/greene_labor.dta")
llprobit <- function(b,x,y) {#
#
y <- as.matrix(y)#
x <- as.matrix(x)#
xint <- as.matrix(1,x)#
xb <- xint %*% b #
#
return(-sum (y * (log(pnorm(xb))) + (1-y) * log(1-pnorm(xb)))) #
}#
#
x <-  as.matrix(data[,2],data[,9],data[,5],data[,3],data[,10])#
xint <-as.matrix(1,x)#
y <- data[,1]#
#
#
bols <- (solve(t(xint) %*% xint)) %*% (t(xint) %*% y)#
bols#
out <- optim(bols,llprobit,x=x,y=y,method="BFGS",hessian = T)#
out#
stderrs <- as.matrix(sqrt(diag(solve(out$hessian))))#
#
print(cbind(out$par,stderrs),digits=3)
rm(list = ls())#
library(MASS)#
library(foreign)#
data <- read.dta("/Users/alissastollwerk/Documents/Columbia/Fall 2010/POLS W4291 - LDV Stats/greene_labor.dta")#
#
llprobit <- function(b,x,y) {#
#
y <- as.matrix(y)#
x <- as.matrix(x)#
xint <- cbind(1,x)#
xb <- xint %*% b #
#
return(-sum (y * (log(pnorm(xb))) + (1-y) * log(1-pnorm(xb)))) #
}#
#
x <-  cbind(data[,2],data[,9],data[,5],data[,3],data[,10])#
xint <-cbind(1,x)#
y <- data[,1]#
#
#
bols <- (solve(t(xint) %*% xint)) %*% (t(xint) %*% y)#
bols#
out <- optim(bols,llprobit,x=x,y=y,method="BFGS",hessian = T)#
out#
stderrs <- as.matrix(sqrt(diag(solve(out$hessian))))#
#
print(cbind(out$par,stderrs),digits=3)
rm(list = ls())#
library(MASS)#
library(foreign)#
data <- read.dta("/Users/alissastollwerk/Documents/Columbia/Fall 2010/POLS W4291 - LDV Stats/greene_labor.dta")
llprobit <- function(b,x,y) {#
#
y <- as.matrix(y)#
x <- as.matrix(x)#
xint <- cbind(1,x)#
xb <- xint %*% b #
#
return(-sum (y * (log(pnorm(xb))) + (1-y) * log(1-pnorm(xb)))) #
}#
#
x <-  cbind(data[,2],data[,9],data[,5],data[,3],data[,10])#
xint <-cbind(1,x)#
y <- data[,1]#
#
#
bols <- (solve(t(xint) %*% xint)) %*% (t(xint) %*% y)#
bols#
out <- optim(bols,llprobit,x=x,y=y,method="BFGS",hessian = T)#
out#
stderrs <- as.matrix(sqrt(diag(solve(out$hessian))))#
#
print(cbind(out$par,stderrs),digits=3)
llprobit <- function(b,x,y) {#
#
y <- as.matrix(y)#
x <- as.matrix(x)#
xint <- as.matrix(1,x)#
xb <- xint %*% b #
#
return(-sum (y * (log(pnorm(xb))) + (1-y) * log(1-pnorm(xb)))) #
}#
#
x <-  as.matrix(data[,2],data[,9],data[,5],data[,3],data[,10])#
xint <- as.matrix(1,x)#
y <- data[,1]
bols <- (solve(t(xint) %*% xint)) %*% (t(xint) %*% y)#
bols
out <- optim(bols,llprobit,x=x,y=y,method="BFGS",hessian = T)#
out
rm(list = ls())#
library(MASS)#
library(foreign)#
data <- read.dta("/Users/alissastollwerk/Documents/Columbia/Fall 2010/POLS W4291 - LDV Stats/greene_labor.dta")
y <- data[,1]
x <-  as.matrix(data[,2],data[,9],data[,5],data[,3],data[,10])
probit <- glm(y~x, family=binomial(link="probit"))
summary(probit)
rm(list = ls())#
library(MASS)#
library(foreign)#
data <- read.dta("/Users/alissastollwerk/Documents/Columbia/Fall 2010/POLS W4291 - LDV Stats/greene_labor.dta")
llprobit <- function(b,x,y) {#
#
y <- as.matrix(y)#
x <- as.matrix(x)#
xint <- as.matrix(1,x)#
xb <- xint %*% b #
#
return(-sum (y * (log(pnorm(xb))) + (1-y) * log(1-pnorm(xb)))) #
}#
#
x <-  as.matrix(data[,2],data[,9],data[,5],data[,3],data[,10])#
xint <- as.matrix(1,x)#
y <- data[,1]#
#
#
bols <- (solve(t(xint) %*% xint)) %*% (t(xint) %*% y)#
bols#
out <- optim(bols,llprobit,x=x,y=y,method="BFGS",hessian = T)#
out#
stderrs <- as.matrix(sqrt(diag(solve(out$hessian))))#
#
print(cbind(out$par,stderrs),digits=3)
rm(list = ls())#
library(MASS)#
library(foreign)#
data <- read.dta("/Users/alissastollwerk/Documents/Columbia/Fall 2010/POLS W4291 - LDV Stats/greene_labor.dta")
llprobit <- function(b,x,y) {#
#
y <- as.matrix(y)#
x <- as.matrix(x)#
xint <- cbind(1,x)#
xb <- xint %*% b #
#
return(-sum (y * (log(pnorm(xb))) + (1-y) * log(1-pnorm(xb)))) #
}#
#
x <-  cbind(data[,2],data[,9],data[,5],data[,3],data[,10])#
xint <- cbind(1,x)#
y <- data[,1]#
#
#
bols <- (solve(t(xint) %*% xint)) %*% (t(xint) %*% y)#
bols#
out <- optim(bols,llprobit,x=x,y=y,method="BFGS",hessian = T)#
out#
stderrs <- as.matrix(sqrt(diag(solve(out$hessian))))
rm(list = ls())#
library(MASS)#
library(foreign)
n <- 1000
b <- c(5,1)
x <- rnorm(n)
u <- rnorm(n)
ystar <- cbind(rep(1,n),x) %*% b + u
y <- as.numeric(ystar > 0)*ystar
ystar#
y
summary(ystar)
#
xyreg<-lm(y~x)#
xyreg
plot(x,y,xlim=c(-5,5),ylim=c(-5,10))
abline(b,lty=2)
#
abline(xyreg)
lltobit <- function(b,x,y) {#
sigma <- b[3] #
y  <- as.matrix(y)#
x <- as.matrix(x)#
onevec <- rep(1,nrow(x)) #
x <- cbind(onevec,x)#
bx <- x %*% b[1:2] #
d <- y != 0 #
llik <- sum(d * ((-1/2)*(log(2*pi) + log(sigma^2) + ((y - bx)/sigma)^2)) + (1-d) * (log(1 - pnorm(bx/sigma))))#
return(-llik)#
}
xint <-  cbind(rep(1,n),x)#
#
bols <- (solve(t(xint) %*% xint)) %*% (t(xint) %*% y)#
#
startval <- rbind(as.matrix(bols[1:nrow(bols)]),1)
out <- optim(startval,lltobit,x=x,y=y,hessian = TRUE,method="BFGS",control=list(trace=1,REPORT=1))#
#
stderrs <- as.matrix(sqrt(diag(solve(out$hessian))))#
#
print(cbind(out$par,stderrs),digits=3)
rm(list = ls())#
library(MASS)#
library(foreign)#
data <- read.dta("/Users/alissastollwerk/Documents/Columbia/Fall 2010/POLS W4291 - LDV Stats/greene_labor.dta")#
inc <- data[,5]/1000
llprobit <- function(b,x,y) {#
#
y <- as.matrix(y)#
x <- as.matrix(x)#
xint <- cbind(1,x)#
xb <- xint %*% b #
#
return(-sum (y * (log(pnorm(xb))) + (1-y) * log(1-pnorm(xb)))) #
}#
#
x <-  cbind(data[,2],data[,9],inc,data[,3],data[,10])#
xint <- cbind(1,x)#
y <- data[,1]#
#
#
bols <- (solve(t(xint) %*% xint)) %*% (t(xint) %*% y)#
bols#
out <- optim(bols,llprobit,x=x,y=y,method="BFGS",hessian = T)#
out#
stderrs <- as.matrix(sqrt(diag(solve(out$hessian))))#
#
print(cbind(out$par,stderrs),digits=3)
probit <- glm(y~x, family=binomial(link="probit"))#
#
summary(probit)
lambdahat <- dnorm(xb)/pnorm(xb)#
lambdahat
xb <- xint %*% b
rm(list = ls())#
library(MASS)#
library(foreign)#
data <- read.dta("/Users/alissastollwerk/Documents/Columbia/Fall 2010/POLS W4291 - LDV Stats/greene_labor.dta")
inc <- data[,5]/1000
llprobit <- function(b,x,y) {#
#
y <- as.matrix(y)#
x <- as.matrix(x)#
xint <- cbind(1,x)#
xb <- xint %*% b #
#
return(-sum (y * (log(pnorm(xb))) + (1-y) * log(1-pnorm(xb)))) #
}#
#
x <-  cbind(data[,2],data[,9],inc,data[,3],data[,10])#
xint <- cbind(1,x)#
y <- data[,1]#
#
#
bols <- (solve(t(xint) %*% xint)) %*% (t(xint) %*% y)#
bols#
out <- optim(bols,llprobit,x=x,y=y,method="BFGS",hessian = T)#
out#
stderrs <- as.matrix(sqrt(diag(solve(out$hessian))))#
#
print(cbind(out$par,stderrs),digits=3)
rm(list=ls())#
library(MASS)#
library(foreign)
set.seed(111)#
n <- 1000#
b <- c(5,1)#
x <- rnorm(n)#
u <- rnorm(n)#
ystar <- cbind(rep(1,n),x) %*% b + u
plot(x,ystar,type="p",xlim=c(-5,5),ylim=c(-5,10))
y <- as.vector(ystar)#
y[ystar < 0] <- 0
plot(x,y,type="p",xlim=c(-5,5),ylim=c(-5,10))
xyreg<-lm(y~x)#
#
xyreg
abline(xyreg, lty=2)
zeromat <- matrix(0,3,3)#
zeromat
x <- as.matrix(c(1,2,3,4))#
class(x)#
dim(x)#
#
## to turn x vector i
t(x)#
# or could do#
xt <- t(x)#
dim(xt)#
## could also type #
dim(t(x))
x %*% x
x %*% t(x)
y %*% t(y)#
diag(y %*% t(y))#
a <- diag(2,4,4)#
diag(a) <- y#
a
y <- x
y %*% t(y)
diag(y %*% t(y))
a <- diag(2,4,4)
diag(a) <- y
a
a <- diag(2,4,4)#
a
diag(a) <- y#
a
cbind(1,a)
cbind(seq(1,4,1),a)
c(1,a)
rbind(1,a)
cbind(a,1)
a1 <-cbind(1,a)
a1
a1[-1]
a1[-1,]
a1[1,1]
a1[4,4]
a1[4,5]
nrow(a1)
ncol(a1)
a1[nrow(a1),ncol(a1)]
a1[1:4,5]
a1[4,]
a1[-4,]
a1[1:4,4]
a1[4,1:3]
a1#
a1[-c(1,3),]
rm(list=ls(all=TRUE))#
library(foreign)
setwd("/Users/alissastollwerk/Documents/Columbia/Dropbox/Field Experimentation Book/Final Code for Vignettes and Problems/Chapter 7")#
Angrist <- read.dta("Chapter 7_Angrist, Bettinger, and Kremer (2006) Dataset.dta")
attach(Angrist)
as.data.frame(Angrist)
write.csv(Angrist,"Chapter_7_AngristBettingerKremer2006Dataset.csv")
load("/Users/alissastollwerk/Documents/Columbia/Dropbox/Field Experimentation Book/Final Code for Vignettes and Problems/Chapter 8/Section 8.4 Hotspots/10of30.rdata")
load("/Users/alissastollwerk/Documents/Columbia/Dropbox/Field Experimentation Book/Final Code for Vignettes and Problems/Chapter 8/Section 8.4 Hotspots/10of30.rdata")
10of30
rm(list=ls(all=TRUE))#
library(foreign)#
#
setwd("/Users/alissastollwerk/Documents/Columbia/Dropbox/Field Experimentation Book/Final Code for Vignettes and Problems/Chapter 9")#
Incentives <- read.dta("Incentives_JPE_analysis_starter_file-processed.dta")
setwd("/Users/alissastollwerk/Documents/Columbia/Dropbox/Field Experimentation Book/Final Code for Vignettes and Problems/Chapter 9/Section 9.2 Heterogeneity")
Incentives <- read.dta("Incentives_JPE_analysis_starter_file-processed.dta")
attach(Incentives)
as.data.frame(Incentives)
write.csv(Incentives,"Incentives_JPE_analysis_starter_file_processed.csv")
rm(list=ls(all=TRUE))#
library(foreign)
setwd("/Users/alissastollwerk/Documents/Columbia/Dropbox/Field Experimentation Book/Final Code for Vignettes and Problems/Chapter 11")#
collapsedhh <- read.dta("collapsed_hh.dta")
attach(collapsedhh)
as.data.frame(collapsedhh)#
write.csv(collapsedhh,"collapsed_hh.csv")
setwd("~/MA/2019Spring/RA/FEDAI data/Chapter 11")
suppressMessages({
library(foreign)
library(arm)
library(dplyr)
library(knitr)
})
dupas <- read.dta("./Chapter 11_Dupas (2010) Dataset.dta")
dupas <- within(dupas,{
purchased <- as.numeric(purchasednet =="yes")
log_price <- log(price)
region <- cfw_id
})
dupas <- read.dta("./Chapter 11_Dupas (2010) Dataset.dta")
mean(dupas$purchasednet)
dupas <- within(dupas,{
purchased <- as.numeric(purchasednet =="yes")
log_price <- log(price)
region <- cfw_id
})
mean(dupas$purchased)
sum(is.na(dupas$log_price)==T)
summarise(dupas$price)
summary(dupas$price)
sum(dupas$price==0)
sum(dupas$logprice==0)
mean(dupas$logprice)
mean(is.na(dupas$logprice))
sum(is.na(dupas$logprice))
is.na(dupas$logprice)
sum(is.na(dupas$log_price))
is.na(dupas$log_price)
sum(is.na(dupas$log_price))
sum(dupas$log_price==0)
sum(dupas$log_price==1)
sum(dupas$price==0)
sum(dupas$log_price)
sum(is.na(dupas$log_price))
table(dupas$log_price, useNA = 'ifany')
head(dupas$log_price)
dupas_subset <- subset(dupas, price !=0 & region!=4)
model_1 <- glm(purchased ~ log_price*region, data = dupas_subset, family = "binomial")
model_2 <- glm(purchased ~ log_price + region, data = dupas_subset, family = "binomial")
model_1
model_2
typeof(dupas$cfw_id)
typeof(dupas$region)
summary(model_1)
model_2
mean(dupas$purchased)
mean(dupas$region)
table(dupas$region)
dupas_subset$preds_1 <- invlogit(predict(model_1))
head(dupas_subset$preds_1)
View(dupas)
View(dupas_subset)
dupas_subset$preds_2 <- invlogit(predict(model_2))
head(dupas_subset$preds_2)
table_11_3_mod <-
dupas_subset %>%
group_by(region, price) %>%
summarize(purchases = sum(purchased),
non_purchases = sum(purchased==0),
pred_purchases_1 = sum(preds_1),
pred_nonpurchases_1 = sum(1-preds_1),
chi_square_1 = (purchases- pred_purchases_1)^2/ pred_purchases_1 +
( non_purchases- pred_nonpurchases_1)^2/ pred_nonpurchases_1,
pred_purchases_2 = sum(preds_2),
pred_nonpurchases_2 = sum(1-preds_2),
chi_square_2 = (purchases- pred_purchases_2)^2/ pred_purchases_2 +
( non_purchases- pred_nonpurchases_2)^2/ pred_nonpurchases_2)
kable(table_11_3_mod[,c(1:4, 5:7)],caption = "Modified Table 11-3 (Model 1)")
kable(table_11_3_mod[,c(1:4, 8:10)],caption = "Modified Table 11-3 (Model 2)")
table_11_3_mod <-
dupas_subset %>%
group_by(region, price)
table_11_3_mod
kable(table_11_3_mod[,c(1:4, 5:7)],caption = "Modified Table 11-3 (Model 1)")
